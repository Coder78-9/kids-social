<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Kids social - feed</title>

    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #EFCEF0;
            margin: 0;
            font-family: sans-serif;
        }

        .container {
            background: white;
            padding: 20px;
            width: 300px;
            border-radius: 10px;
        }

        .post-box {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        input {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
        }

        button {
            width: 100%;
            padding: 8px;
            margin-bottom: 15px;
            background-color:#a83b84;
        }
    </style>
</head>

<body>

<div class="container">
    <h1>Kids feed</h1>
    <p>You are logged in â€” make a post! You can also do the learning activities</p>
<button onclick="window.location.href='learn.html'">Learning</button>
    <h2>Create a post</h2>
    <input id="post-text" placeholder="Write something...">
    <button id="post-button">Post</button>

    <h2>All posts</h2>
    <div id="posts"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { 
        getAuth, 
        onAuthStateChanged 
    } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

    import { 
        getFirestore, 
        collection, 
        addDoc, 
        onSnapshot
    } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    // Firebase setup
    const firebaseConfig = {
        apiKey: "AIzaSyA6IRJ_0LNbb1KOZt_G174pgYsjDx6zPm4",
        authDomain: "kids-social-5b36f.firebaseapp.com",
        projectId: "kids-social-5b36f",
        storageBucket: "kids-social-5b36f.firebasestorage.app",
        messagingSenderId: "916072443602",
        appId: "1:916072443602:web:eb7dbd40082a66494f470b",
        measurementId: "G-CPCZ7M68PW"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Redirect if NOT logged in
    onAuthStateChanged(auth, (user) => {
        if (!user) {
            window.location.href = "index.html";
        }
    });

    // DOM
    const postInput = document.getElementById("post-text");
    const postButton = document.getElementById("post-button");
    const postsDiv = document.getElementById("posts");

    // Add a post
    postButton.addEventListener("click", () => {
        const text = postInput.value;

        if (text === "") return;

        addDoc(collection(db, "posts"), {
            text: text,
            user: auth.currentUser.email,
            time: Date.now()
        });

        postInput.value = "";
    });

    // Show posts live
    onSnapshot(collection(db, "posts"), (snapshot) => {
        postsDiv.innerHTML = "";

        snapshot.forEach((doc) => {
            const info = doc.data();
            const box = document.createElement("div");

            box.classList.add("post-box");
            box.innerHTML = `
                <p><strong>${info.user}</strong></p>
                <p>${info.text}</p>
            `;

            postsDiv.appendChild(box);
        });
    });
</script>

</body>
</html>
